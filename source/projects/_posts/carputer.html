<DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML><HEAD><TITLE>Brian Hulette - Carputer</TITLE>
<STYLE TYPE="text/css">
@import "./style.css";
</STYLE>
<link rel="stylesheet" type="text/css" href="shadowbox/shadowbox.css">
<script type="text/javascript" src="shadowbox/shadowbox.js"></script>
<script type="text/javascript">
Shadowbox.init();
</script>
</HEAD>
<BODY>
<DIV id="container">

<DIV id="header">
<DIV id="navigation">
<A HREF="index.html">home</A>
<A HREF="about.html">about</A>
<A class="current" HREF="projects.html">projects</A>
<A HREF="links.html">links</A>
</DIV>
</DIV>

<DIV id="body">
<H1>Carputer</H1>
<P>
A few months after I got my new Volvo S70, I began to think that the stereo head unit would be perfect for a carputer (car computer).  
It's a rather large head unit, probably about twice as tall as a typical one, so there would be plenty of space inside for a computer and the other necessary electronics.  
The other great thing about it is that you can remove it just by popping two tabs and pulling it out, making debugging really easy. 
</P>
<P>
Original Head Unit (Before):
<DIV ID="image"><A HREF="images/carputer_before.jpg" rel="shadowbox[carputer]"><IMG SRC="images/carputer_before.jpg"/></A></DIV>
</P>
<P>
Carputer (After):
<DIV ID="image"><A HREF="images/carputer_after.jpg" rel="shadowbox[carputer]"><IMG SRC="images/carputer_after.jpg"/></A></DIV>
</P>
<H2>Parts</H2>
<H3>Computer</H3>
<P>
First I had to decide what computer I was going to put into the thing.  
Building my own was out of the question - I could never make it small enough.  
There are a few commercialy available miniature PCs, but I decided on a Mac Mini.  
It fits nearly perfectly inside the gutted stereo, and it's been used for this sort of thing before, so help would be easier to find, if necessary.
</P>
<H3>Power Supply</H3>
<P>
Unfortunately, my car doesn't have wall outlets, so I needed some sort of power supply to convert the 12V from the battery to a usable voltage for the mac.  
I found exactly what I needed in the <A HREF="http://carnetix.com/CNXP1900.htm">Carnetix CNX-P1900</A>.  
It's a power supply that is made specifically for this purpose.  
Besides just powering the computer and other peripherals, it will accept an ignition signal, and switch the computer on and off with the car rather than just cutting power to it.
</P>
<H3>Amplifiier</H3>
<P>
An amplifier is necessary to drive the speakers based on the audio output of the Mac Mini.  
After a little bit of digging I found out about <A HREF="http://www.41hz.com">41 Hz</A>, a source for amplifier kits based on Tripath's T-Amplifiers.  
These amps are prefect for my purpose, they're cheap, small enough to fit inside the head unit, and they produce great sound.  
From the manual I determined that the original head unit had a 4x25W amplifier inside, so I ordered two of the amp6-basics, which are each 2x25W.  
</P>
<H3>Case</H3>
<P>
Rather than just gutting my old head unit, and going without music for a while, I decided to pick up an old volvo head unit from a junkyard.  
It ended up costing me a little but more but I couldn't count on getting this done quickly.
</P>
<H2>Construction</H2>
<H3>Plan</H3>
<H3>Implementation</H3>
<H2>Problems and Debugging</H2>
<H3>Ground Loop</H3>
<P>
Before taking the time to assemble everything into the head unit, I wanted to make sure that the system worked properly.  
So I connected the battery and speakers to the device and tried starting up the computer,  instead of the familiar mac boot up sound, all I heard was some serious noise.  
</P>
<P>
I spent a good portion of my summer trying to identify the source of this noise.  
I tried putting a <A HREF="http://en.wikipedia.org/wiki/Pi_filter">pi filter</A> on the amplifier's power rail, a passive low pass filter on the audio signal from the mac, and several other filters, but none of them had any effect.  
</P>
<P>
After researching some typical causes of noise in audio systems I realized that I had created a <A HREF="http://en.wikipedia.org/wiki/Ground_loop_(electricity)">ground loop</A> between the amplifier, mac mini, power supply and back to the mac mini.  
Im sure this would be obvious to anyone who had worked with audio and analog systems to any extent, but this was really my first foray into analog, so I never saw it coming.  
</P>
<P>
The solution is just to isolate one of the connections in the loop.  
Since that's not really an option for the power rails, I added a 1:1 transformer to the audio signal between the mac mini and the amplifier.  
This essentially opens up the loop since there is no longer a direct ground connection through the transformer.
</P>
<P>
Once the ground loop was removed, the system worked perfectly.  
Here's a video of that first successful test:
</P>
<center>
<object width="400" height="300">
<param name="allowfullscreen" value="true" />
<param name="allowscriptaccess" value="always" />
<param name="movie" value="http://vimeo.com/moogaloop.swf?clip_id=7115934&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;color=&amp;fullscreen=1" />
<embed src="http://vimeo.com/moogaloop.swf?clip_id=7115934&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;color=&amp;fullscreen=1" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="400" height="300">
</embed>
</object>
</center>
<P>
Since it was working just fine, I went ahead and assembled the whole device and tested it again:
</P>
<center>
<object width="400" height="300">
<param name="allowfullscreen" value="true" />
<param name="allowscriptaccess" value="always" />
<param name="movie" value="http://vimeo.com/moogaloop.swf?clip_id=7115961&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;color=&amp;fullscreen=1" />
<embed src="http://vimeo.com/moogaloop.swf?clip_id=7115961&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;color=&amp;fullscreen=1" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="400" height="300">
</embed>
</object>
</center>
<H3>Battery Draining</H3>
<P>
Unfortunately, the problems didn't end there.  
After installing the device in my car permanently, I managed to completely drain my battery several times.  
This was happening because I had my power supply configured to sleep the computer rather than turn it off when the car wasn't running.  
When I left the car without starting it for a few days, the sleeping computer would drain the battery.
</P>
<P>
I was under the impression that the Carnetix power supply would monitor the battery voltage and turn the computer off if it got too low.  However after a little bit of research I found out that the standard firmware sets the low battery threshold far too low.  
I was able to follow <A HREF="http://www.carnetix.com/firmware/UFlashInstructions.htm">instructions</A> on the Carnetix website to modify the <A HREF="http://www.carnetix.com/firmware/MemoryLocations.htm">constant</A> controlling the threshold, and reflash the power supply.
</DIV>
</BODY>
</HTML>
